{% extends "base.html" %}

{% block title %}
Lumo AI | New Chat
{% endblock %}

{% block content %}
<div class="flex w-full h-full bg-[#3d3d3d] font-inter">

    <!-- Left Panel -->
    <div id="left-panel"
        class="hidden transition-all lg:relative overflow-hidden lg:block lg:w-[16%] bg-[#262626] border-[1px] border-r-[#6d6d6d] max-h-screen">
        <div class="w-full h-[16%] p-2 border-b-[1px] border-[#efefef]">
            <div id="logoHeader" class="flex justify-between mb-5">
                <span class="text-[#efefef] text-4xl font-arimo" id="logo">Lumo</span>
                <button id="collapseSideBar"
                    class="hidden lg:block cursor-pointer font-light text-[#f8f8f8] transition-colors hover:text-[#bdbdbd]">
                    <i class="fa-solid fa-arrow-right-arrow-left"></i>
                </button>
                <button id="hideSideBar"
                    class="lg:hidden cursor-pointer font-light text-[#f8f8f8] transition-colors hover:text-[#bdbdbd] text-2xl">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="flex justify-center">
                <button id="createNewChat"
                    class="w-8/9 cursor-pointer bg-[#f8f8f8] transition-colors py-1 mb-5 hover:bg-[#bdbdbd] text-[#3d3d3d] rounded-[6px] font-arimo">
                    New Chat
                </button>
            </div>
        </div>
        <div class="px-2 mt-5 max-h-[70%] min-h-[70%] text-[#f8f8f8] overflow-y-scroll scrollbar-hide">
            {% for chat in chats %}
            <div class="w-full chatLink">
                <a class="block w-full px-2 py-2 cursor-pointer rounded hover:bg-[#3d3d3d] truncate"
                    href="{% url 'chat' user_id=user.id chat_id=chat.id %}">
                    {{ chat.title }}
                </a>
            </div>
            {% endfor %}
        </div>
        <div class="w-full h-[12%] p-2">
            <div class="bg-[#3d3d3d] p-2 rounded flex justify-between items-center" id="sidebarFooter">
                <img class="w-10 rounded-full cursor-pointer" id="profileImg"
                    src="https://imgs.search.brave.com/1KiyzuDRcHPqmU55ezONAKkAiaxJjIqKAentGsEkpco/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9pLnBp/bmltZy5jb20vb3Jp/Z2luYWxzL2FlLzMx/L2M4L2FlMzFjODEz/M2JhNzUzYTBmZDYx/OGE1MGJmNzhmNTZk/LmpwZw"
                    alt="profile">
                <div class="text-[#f8f8f8] h-full cursor-pointer hover:text-[#bdbdbd]" id="moreOptions">
                    <i class="fa-solid fa-ellipsis"></i>
                </div>
                <div id="options"
                    class="hidden absolute text-[#f8f8f8] bottom-[11%] right-2 lg:left-[68%] bg-[#262626] border-2 hover:bg-[#3d3d3d] cursor-pointer border-[#6d6d6d] rounded px-2">
                    <form method="post" action="{% url 'logout' %}" class="w-full h-full">
                        {% csrf_token %}
                        <button type="submit" class="text-center w-full h-full cursor-pointer">
                            <i class="fa-solid fa-arrow-right-from-bracket"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Right Panel -->
    <div id="right-panel"
        class="w-full flex-1 p-4 h-screen text-white flex flex-col justify-center items-center gap-y-14">
        <div>
            <span
                class="text-4xl lg:text-7xl font-arimo bg-gradient-to-br from-[#f8f8f8] to-[#3d3d3d] bg-clip-text text-transparent font-bold">Hey,
                I'm Lumo</span>
        </div>
        <div class="bg-[#6d6d6d] rounded-3xl w-full lg:w-2/4 p-4">
            <form method="post">
                {% csrf_token %}
                <div class="w-full">
                    {{ form.text }}
                </div>
                <div class="text-3xl float-end">
                    <button type="submit" id="submitBtn"><i
                            class="fa-solid fa-circle-up cursor-pointer transition-colors text-[#f8f8f8] hover:text-[#bdbdbd]"></i></button>
                </div>
            </form>
        </div>
    </div>
    <!-- Hamburger :mobile -->
    <button id="bars"
        class="lg:hidden transition-transform absolute text-2xl text-[#f8f8f8] hover:text-[#bdbdbd] cursor-pointer top-3 left-3">
        <i class="fa-solid fa-bars"></i>
    </button>
</div>
{% endblock %}

{% block script %}
<script>
    const barsBtn = document.getElementById("bars");
    const submitBtn = document.getElementById("submitBtn");
    const hideSideBarBtn = document.getElementById("hideSideBar");
    const collapseSideBarBtn = document.getElementById("collapseSideBar");
    const createNewChatBtn = document.getElementById("createNewChat");
    const moreOptionsBtn = document.getElementById("moreOptions");
    const options = document.getElementById("options");
    const leftPanel = document.getElementById("left-panel");
    const rightPanel = document.getElementById("right-panel");
    const promptArea = document.getElementById('promptArea');

    barsBtn.addEventListener('click', () => {

        leftPanel.classList.add('w-full')
        leftPanel.classList.remove('hidden')

        rightPanel.classList.add('hidden')
        rightPanel.classList.remove('w-full')

        barsBtn.classList.add('hidden')
    })

    submitBtn.addEventListener('click', () => {
        submitBtn.innerHTML = `<i class="fa-solid fa-spinner cursor-progress transition-colors text-[#f8f8f8] hover:text-[#bdbdbd] animate-spin"></i>`
    })

    hideSideBarBtn.addEventListener('click', () => {
        leftPanel.classList.remove('w-full')
        leftPanel.classList.add('hidden')

        rightPanel.classList.remove('hidden')
        rightPanel.classList.add('w-full')

        barsBtn.classList.remove('hidden')
    })

    collapseSideBarBtn.addEventListener('click', () => {

        // back into normal width
        leftPanel.classList.toggle('lg:w-[5%]')
        leftPanel.classList.toggle('lg:w-[16%]')

        // display logo
        document.getElementById('logo').classList.toggle('hidden')

        // Alter header
        document.getElementById('logoHeader').classList.toggle('justify-center')

        // alter create new chat button
        createNewChatBtn.classList.toggle('rounded-full')
        createNewChatBtn.innerHTML = leftPanel.classList.contains('lg:w-[16%]') ? `New Chat` : `<i class="fa-solid fa-plus"></i>`

        // display chat links
        document.querySelectorAll('.chatLink').forEach(e => e.classList.toggle('hidden'))

        // change footer color and hide more options button
        document.getElementById('sidebarFooter').classList.toggle('bg-transparent')
        moreOptionsBtn.classList.toggle('hidden')
        options.classList.toggle('lg:left-[68%]')
        options.classList.toggle('lg:left-[0%]')

        // remove event listener on profile image for more options
        if (leftPanel.classList.contains('lg:w-[16%]')) document.getElementById("profileImg").removeEventListener('click', toggleOptions)
        else document.getElementById('profileImg').addEventListener('click', toggleOptions)
    })

    moreOptionsBtn.addEventListener('click', toggleOptions)

    function toggleOptions() {
        options.classList.toggle('hidden')
    }

    promptArea.addEventListener('input', (e) => {
        if (!e.target.value.length) {
            promptArea.classList.add('h-12')
            promptArea.classList.remove('h-70')
        } else {
            promptArea.classList.add('h-70')
            promptArea.classList.remove('h-12')
        }
    })
</script>
{% endblock %}